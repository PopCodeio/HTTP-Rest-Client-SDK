<?php
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
/**
 * NOC Application
 *
 * Noc Site and Scripts
 *
 * PHP versions 5
 *
 * LICENSE: Copyright Green Virtual Solutions 2010
 *
 * @category  gvs
 * @package   noc
 * @author    Paul Kruger <paul@greenvirtualsolutions.com>
 * @author    Aldo Delgado <aldo@greenvirtualsolutions.com>
 * @copyright 2011 Green Virtual Solutions
 * @license   http://noc.greenvirtualsolutions/Licence.txt
 * @version   SVN: $Id:$
 */
/**
 * HttpRequest 
 * 
 * <code>
 *  $httprequest = new HttpRequest;
 *  // User list
 *  $user_list = $httprequest->get('http://api.savvypenny.com:3000/users.json');
 *   
 *  $new_user = array(
 *      'user' => array(
 *          'login' => 'test',
 *          'email' => 'smack@123.com',
 *          'mobile' => '4442221123',
 *          'first_name' => 'Joe',
 *          'last_name' => 'Smith',
 *          'birth_year' => '1974',
 *          'gender' => 'male',
 *          'address' => '123 home st',
 *          'address2' => 'suite 3',
 *          'state' => 'FL',
 *          'city' => 'Hollywood',
 *          'zip' => '33301',
 *          'income' => '55000',
 *          'sms' => '1',
 *          'newsletter' => '1',
 *          'mac' => '00:00:00:00:00',
 *          'agreed_to_terms' => '1'
 *          #'created_at' => '',
 *          #'home' => '',
 *      )
 *  );
 * 
 *  // User create 
 *  $user_create = $httprequest->post('http://api.savvypenny.com:3000/users.json',$new_user);
 *
 * $search_params = array(
 *    'mobile' => '4442221123'
 *   );
 *
 * $update_params = array(
 *    'user' => array(    
 *        'mobile' => '5552221123'
 *     )
 * );
 *
 *  // User search
 *  $user_search = $httprequest->post('http://api.savvypenny.com:3000/searches/users.json', $search_params);
 *
 *  // User update
 *  $user_update = $httprequest->put('http://api.savvypenny.com:3000/users/'.$user_search[response][0]->result->user->id.'.json', $update_params);
 *
 *  // User destroy
 *  $user_destroy = $httprequest->delete('http://api.savvypenny.com:3000/users/'.$user_search[response][0]->result->user->id.'.json');
 * </code> 
 *
 * @package   noc
 * @version   //autogen//
 * @copyright Copyright (c) 2010 All rights reserved.
 * @author    Paul Kruger <paul@greenvirtualsolutions.com>
 * @author    Aldo Delgado <aldo@greenvirtualsolutions.com>
 * @license PHP Version 3.0 {@link http://www.php.net/license/3_0.txt}
 */
class HttpRequest {
    var $verbose = 0;
    var $status_codes = array(
        0                => 'Could Not Connect',
        100              => 'Continue',
        101              => 'Switching Protocols',
        102              => 'Processing',
        200              => 'OK',
        201              => 'Created',
        202              => 'Accepted',
        203              => 'Non-Authoritative Information',
        204              => 'No Content',
        205              => 'Reset Content',
        206              => 'Partial Content',
        207              => 'Multi-Status',
        226              => 'IM Used',
        300              => 'Multiple Choices',
        301              => 'Moved Permanently',
        302              => 'Found',
        303              => 'See Other',
        304              => 'Not Modified',
        305              => 'Use Proxy',
        306              => 'Reserved',
        307              => 'Temporary Redirect',
        400              => 'Bad Request',
        401              => 'Unauthorized',
        402              => 'Payment Required',
        403              => 'Forbidden',
        404              => 'Not Found',
        405              => 'Method Not Allowed',
        406              => 'Not Acceptable',
        407              => 'Proxy Authentication Required',
        408              => 'Request Timeout',
        409              => 'Conflict',
        410              => 'Gone',
        411              => 'Length Required',
        412              => 'Precondition Failed',
        413              => 'Request Entity Too Large',
        414              => 'Request-URI Too Long',
        415              => 'Unsupported Media Type',
        416              => 'Requested Range Not Satisfiable',
        417              => 'Expectation Failed',
        422              => 'Unprocessable Entity',
        423              => 'Locked',
        424              => 'Failed Dependency',
        426              => 'Upgrade Required',
        500              => 'Internal Server Error',
        501              => 'Not Implemented',
        502              => 'Bad Gateway',
        503              => 'Service Unavailable',
        504              => 'Gateway Timeout',
        505              => 'HTTP Version Not Supported',
        506              => 'Variant Also Negotiates',
        507              => 'Insufficient Storage',
        510              => 'Not Extended'
    );
    /**
     * put
     * 
     * @param mixed $url 
     * @param mixed $fields 
     * @access public
     * @return void
     */
    function put($url, $fields) {
        $result       = array();
        $fields       = (is_array($fields)) ? http_build_query($fields) : $fields;
        $fp           = fopen('fields.txt', 'w');
        fwrite($fp, $fields);
        if ($ch = curl_init($url)) {
            curl_setopt($ch, CURLOPT_POST, 1);
            curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_VERBOSE, $this->verbose);
            //curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Length: ' . strlen($fields)));
            curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
            ob_start();
            $result['response_raw'] = curl_exec($ch);
            $result['response'] = json_decode($result['response_raw']);
            ob_end_clean();
            $result['info'] = curl_getinfo($ch);
            $result['status'] = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            curl_close($ch);
            $result['status_message'] = $this->status_codes[$result['status']];
            fclose($fp);
            return $result;
        }
        else {
            fclose($fp);
            return false;
        }
    }
    /**
     * post
     * 
     * @param mixed $url 
     * @param mixed $fields 
     * @access public
     * @return void
     */
    function post($url, $fields) {
        $result = array();
        $fields = (is_array($fields)) ? http_build_query($fields) : $fields;
        if ($ch     = curl_init($url)) {
            curl_setopt($ch, CURLOPT_POST, 1);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($ch, CURLOPT_VERBOSE, $this->verbose);
            //curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Length: ' . strlen($fields)));
            curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);
            ob_start();
            $result['response_raw'] = curl_exec($ch);
            $result['response'] = json_decode($result['response_raw']);
            ob_end_clean();
            $result['info'] = curl_getinfo($ch);
            $result['status'] = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            curl_close($ch);
            $result['status_message'] = $this->status_codes[$result['status']];
            return $result;
        }
        else {
            return false;
        }
    }
    function get($url) {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_HTTPGET, true);
        // SSL verifier should be set to true for higher
        // security, but causes issues on some platforms
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_VERBOSE, $this->verbose);
        ob_start();
        $result['response_raw'] = curl_exec($ch);
        $result['response'] = json_decode($result['response_raw']);
        ob_end_clean();
        $result['info'] = curl_getinfo($ch);
        $result['status'] = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);
        $result['status_message'] = $this->status_codes[$result['status']];
        return $result;
    }
    function delete($url) {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        // SSL verifier should be set to true for higher
        // security, but causes issues on some platforms
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'DELETE');
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_VERBOSE, $this->verbose);
        ob_start();
        $result['response_raw'] = curl_exec($ch);
        $result['response'] = json_decode($result['response_raw']);
        ob_end_clean();
        $result['info'] = curl_getinfo($ch);
        $result['status'] = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);
        return $result;
    }
}
?>
